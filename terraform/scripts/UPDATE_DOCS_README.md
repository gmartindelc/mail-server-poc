# Vultr Documentation Updater

Automatically update Terraform documentation files from Vultr CSV data.

## Overview

These scripts read the CSV files generated by `vultr_resource_retriever.py` and create/update the corresponding markdown documentation files used in your Terraform project.

**Important:** By default, the scripts **delete the CSV files** after successfully generating the markdown documentation. Use the `--keep-csv` flag if you want to preserve the CSV files.

## Files

- **update_vultr_docs.py** - Python script (recommended, more features)
- **update_vultr_docs.sh** - Bash script (lighter, fewer dependencies)

## What Gets Updated

The scripts update three markdown files:

| Input CSV | Output Markdown | Description |
|-----------|-----------------|-------------|
| `vultr_plans_*.csv` | `PLAN_IDS.md` | Server plan specifications and pricing |
| `vultr_regions_*.csv` | `REGION_CODES.md` | Data center locations and codes |
| `vultr_os_*.csv` | `OS_IDS.md` | Operating system IDs and details |

## Directory Structure

```
your-project/
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ vultr_plans_20251218_131843.csv
‚îÇ   ‚îú‚îÄ‚îÄ vultr_regions_20251218_131843.csv
‚îÇ   ‚îú‚îÄ‚îÄ vultr_os_20251218_131843.csv
‚îÇ   ‚îú‚îÄ‚îÄ update_vultr_docs.py          ‚Üê Updater script
‚îÇ   ‚îî‚îÄ‚îÄ update_vultr_docs.sh          ‚Üê Updater script
‚îú‚îÄ‚îÄ PLAN_IDS.md                        ‚Üê Generated/Updated
‚îú‚îÄ‚îÄ REGION_CODES.md                    ‚Üê Generated/Updated
‚îî‚îÄ‚îÄ OS_IDS.md                          ‚Üê Generated/Updated
```

## Usage

### Python Script (Recommended)

#### Basic Usage
```bash
# Run from project root directory
python3 update_vultr_docs.py
```

#### Custom Directories
```bash
# Specify custom locations
python3 update_vultr_docs.py \
  --scripts-dir ./scripts \
  --docs-dir ./docs
```

#### Keep CSV Files
```bash
# Preserve CSV files after processing
python3 update_vultr_docs.py --keep-csv
```

#### From Within Scripts Directory
```bash
cd scripts
python3 update_vultr_docs.py --docs-dir ..
```

### Bash Script

#### Basic Usage
```bash
# Run from project root directory
./update_vultr_docs.sh
```

#### Custom Directories
```bash
# Using environment variables
SCRIPTS_DIR=./scripts DOCS_DIR=. ./update_vultr_docs.sh
```

#### Keep CSV Files
```bash
# Preserve CSV files after processing
./update_vultr_docs.sh --keep-csv
```

#### From Within Scripts Directory
```bash
cd scripts
DOCS_DIR=.. ./update_vultr_docs.sh
```

## Requirements

### Python Script
- Python 3.6+
- No additional packages required (uses standard library)

### Bash Script
- bash
- Standard Unix utilities (sed, awk, tail, wc)
- bc (optional, for RAM unit conversion)

Install bc if needed:
```bash
# Ubuntu/Debian
sudo apt-get install bc

# macOS
brew install bc

# RHEL/CentOS
sudo yum install bc
```

## Features

### Python Script Features
- ‚úÖ Automatic detection of latest CSV files
- ‚úÖ **Automatic CSV cleanup** (deletes CSV files after processing)
- ‚úÖ Organized output by type/family/continent
- ‚úÖ Table of contents with anchor links
- ‚úÖ Detailed tables with all available fields
- ‚úÖ Usage examples with Terraform code
- ‚úÖ Popular choices and recommendations
- ‚úÖ Error handling and validation
- ‚úÖ Progress indicators

### Bash Script Features
- ‚úÖ Automatic detection of latest CSV files
- ‚úÖ **Automatic CSV cleanup** (deletes CSV files after processing)
- ‚úÖ Lightweight and fast
- ‚úÖ No Python required
- ‚úÖ Colorized output
- ‚úÖ Basic table generation
- ‚úÖ Usage examples included

## Output Format

### PLAN_IDS.md
Contains:
- Summary with total plan count
- Complete plans table sorted by cost
- Detailed sections grouped by plan type
- Terraform usage examples
- All specifications (CPU, RAM, disk, bandwidth, cost)

### REGION_CODES.md
Contains:
- Summary with total region count
- Quick reference table with all regions
- Regions organized by continent
- Common region quick reference
- Terraform usage examples

### OS_IDS.md
Contains:
- Summary with total OS count
- Complete OS table
- Operating systems grouped by family
- Popular choices with use cases
- Terraform usage examples
- Notes on LTS and architecture

## Automation

### Add to Your Workflow

#### Option 1: Update Script
Add to your existing update script:

```bash
#!/bin/bash
# update_all.sh

# Fetch latest Vultr data
cd scripts
python3 vultr_resource_retriever.py

# Update documentation
python3 update_vultr_docs.py --docs-dir ..

echo "‚úÖ Vultr data and docs updated!"
```

#### Option 2: Makefile
```makefile
.PHONY: update-vultr update-docs

update-vultr:
	cd scripts && python3 vultr_resource_retriever.py

update-docs:
	python3 update_vultr_docs.py

update-all: update-vultr update-docs
	@echo "‚úÖ All Vultr documentation updated"
```

Usage:
```bash
make update-all
```

#### Option 3: Git Pre-commit Hook
Create `.git/hooks/pre-commit`:

```bash
#!/bin/bash
# Auto-update docs if CSV files changed

if git diff --cached --name-only | grep -q "scripts/vultr_.*\.csv"; then
    echo "üìù Updating Vultr documentation..."
    python3 update_vultr_docs.py
    
    # Stage updated markdown files
    git add PLAN_IDS.md REGION_CODES.md OS_IDS.md
fi
```

## Command Line Options

### Python Script
```
usage: update_vultr_docs.py [-h] [--scripts-dir SCRIPTS_DIR] [--docs-dir DOCS_DIR] [--keep-csv]

Update Vultr documentation markdown files from CSV data

optional arguments:
  -h, --help            show this help message and exit
  --scripts-dir SCRIPTS_DIR
                        Directory containing CSV files (default: ./scripts)
  --docs-dir DOCS_DIR   Directory containing markdown files (default: current directory)
  --keep-csv            Keep CSV files after generating documentation (default: delete them)
```

### Bash Script
```
Usage: update_vultr_docs.sh [OPTIONS]

OPTIONS:
  -k, --keep-csv          Keep CSV files after generating documentation
  -s, --scripts-dir DIR   Directory containing CSV files (default: ./scripts)
  -d, --docs-dir DIR      Directory for markdown files (default: .)
  -h, --help              Display help message

Environment Variables:
  SCRIPTS_DIR    Directory containing CSV files (default: ./scripts)
  DOCS_DIR       Directory containing markdown files (default: .)
```

## Examples

### Example 1: Standard Update
```bash
# Fetch latest data
cd scripts
python3 vultr_resource_retriever.py

# Update docs (from project root)
cd ..
python3 update_vultr_docs.py
```

### Example 2: Custom Project Structure
```bash
# For structure: project/terraform/scripts/ and project/terraform/docs/
python3 update_vultr_docs.py \
  --scripts-dir ./terraform/scripts \
  --docs-dir ./terraform/docs
```

### Example 3: Cron Job
```bash
# Add to crontab (run daily at 2 AM)
0 2 * * * cd /path/to/project && python3 scripts/vultr_resource_retriever.py && python3 update_vultr_docs.py
```

### Example 4: CI/CD Integration
```yaml
# .github/workflows/update-vultr-docs.yml
name: Update Vultr Documentation

on:
  schedule:
    - cron: '0 0 * * 0'  # Weekly on Sunday
  workflow_dispatch:      # Manual trigger

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'
      
      - name: Install dependencies
        run: pip install requests
      
      - name: Fetch Vultr data
        run: python3 scripts/vultr_resource_retriever.py
        
      - name: Update documentation
        run: python3 update_vultr_docs.py
        
      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add *.md scripts/vultr_*.csv
          git commit -m "Update Vultr documentation" || echo "No changes"
          git push
```

## Troubleshooting

### "No CSV file found"
**Problem:** Script can't find CSV files
**Solution:** 
```bash
# Check if CSV files exist
ls -la scripts/vultr_*.csv

# Generate them first
cd scripts
python3 vultr_resource_retriever.py
```

### "Permission denied"
**Problem:** Scripts not executable
**Solution:**
```bash
chmod +x update_vultr_docs.py
chmod +x update_vultr_docs.sh
```

### CSV Files with Different Names
**Problem:** CSV files don't match the expected pattern
**Solution:** The scripts look for `vultr_plans_*.csv`, `vultr_regions_*.csv`, and `vultr_os_*.csv` patterns. Make sure your CSV files follow this naming convention.

### Incorrect RAM Values (Bash Script)
**Problem:** RAM shown in MB instead of GB
**Solution:** Install `bc` for proper calculations:
```bash
sudo apt-get install bc  # Ubuntu/Debian
brew install bc          # macOS
```

## Best Practices

1. **Version Control**: Commit both CSV and MD files
2. **Regular Updates**: Run weekly or monthly to keep docs current
3. **Automation**: Use cron jobs or CI/CD for automatic updates
4. **Backup**: Keep old CSV files for historical reference
5. **Review Changes**: Check git diff before committing updates

## Integration with Terraform

The generated markdown files are designed to be used as reference documentation for your Terraform configurations:

```hcl
# main.tf
resource "vultr_instance" "mail_server" {
  # Refer to PLAN_IDS.md for available plans
  plan = "vc2-1c-1gb"
  
  # Refer to REGION_CODES.md for region codes
  region = "ewr"
  
  # Refer to OS_IDS.md for operating system IDs
  os_id = 387
  
  label = "mail-server-${var.environment}"
}
```

## Support

For issues or questions:
1. Check the [troubleshooting section](#troubleshooting)
2. Review the [examples](#examples)
3. Check Vultr API documentation: https://www.vultr.com/api/

## Related Scripts

- `vultr_resource_retriever.py` - Fetches data from Vultr API
- `vultr_resource_retriever.sh` - Bash version of data fetcher

## License

These scripts are provided as-is for use with Vultr and Terraform projects.
