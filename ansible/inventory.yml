---
# Ansible Inventory for Mail Server PoC
# Location: ansible/inventory.yml
#
# IMPORTANT: This inventory uses environment variables for dynamic configuration.
# The run_task.sh script handles credential parsing automatically.
#
# Required environment variables:
#   MAIL_SERVER_IP - Server IP (set by run_task.sh)
#   MAIL_SERVER_PASS - Root password (set by run_task.sh)
#
# Optional environment variables (for tasks after 1.3.1):
#   ANSIBLE_REMOTE_PORT - SSH port (default: 22, set to 2288 after Task 1.3.1)
#   ANSIBLE_REMOTE_USER - SSH user (default: root, set to phalkonadmin after Task 1.3.1)
#   ANSIBLE_PRIVATE_KEY_FILE - SSH key path (default: Vultr key, set to bastion key after Task 1.3.1)

all:
  children:
    mail_servers:
      hosts:
        mail_server:
          # Server connection details (set by run_task.sh)
          ansible_host: "{{ lookup('env', 'MAIL_SERVER_IP') }}"
          
          # SSH Port - dynamic based on task phase
          # Tasks 1.1.x - 1.3.1: port 22
          # Tasks 1.3.2+: port 2288 (export ANSIBLE_REMOTE_PORT=2288)
          ansible_port: "{{ lookup('env', 'ANSIBLE_REMOTE_PORT') | default('22', true) }}"
          
          # SSH User - dynamic based on task phase
          # Tasks 1.1.x - 1.3.1: root
          # Tasks 1.3.2+: phalkonadmin (export ANSIBLE_REMOTE_USER=phalkonadmin)
          ansible_user: "{{ lookup('env', 'ANSIBLE_REMOTE_USER') | default('root', true) }}"
          
          # SSH Authentication
          ansible_ssh_pass: "{{ lookup('env', 'MAIL_SERVER_PASS') }}"
          
          # SSH Key - dynamic based on task phase
          # Tasks 1.1.x - 1.3.1: Vultr key
          # Tasks 1.3.2+: Bastion key (export ANSIBLE_PRIVATE_KEY_FILE=~/SSH_KEYS_CAPITAN_TO_WORKERS/id_ed25519_common)
          ansible_ssh_private_key_file: "{{ lookup('env', 'ANSIBLE_PRIVATE_KEY_FILE') | default('~/.ssh/id_ed25519_lc02_vultr', true) }}"
          
          ansible_python_interpreter: /usr/bin/python3
          
          # Server metadata
          server_role: mail_server
          server_environment: poc
          server_hostname: cucho1.phalkons.com
          
          # Network configuration
          vpn_network: 10.100.0.0/24
          
          # Mail server specific variables
          mail_domain: phalkons.com
          postgres_version: "17"
          
          # SSH Keys paths (for reference)
          vultr_ssh_key: ~/.ssh/id_ed25519_lc02_vultr
          bastion_ssh_key_public: ~/SSH_KEYS_CAPITAN_TO_WORKERS/id_ed25519_common.pub
          bastion_ssh_key_private: ~/SSH_KEYS_CAPITAN_TO_WORKERS/id_ed25519_common
          
  vars:
    # Global variables for all hosts
    ansible_connection: ssh
    ansible_ssh_common_args: '-o StrictHostKeyChecking=accept-new -o UserKnownHostsFile=/dev/null'
