---
- name: Check credentials file
  hosts: all
  become: yes
  tasks:
    - name: Read credentials file
      ansible.builtin.slurp:
        src: /root/postgres_service_users.txt
      register: creds_file
      
    - name: Display file content
      ansible.builtin.debug:
        msg: "{{ creds_file.content | b64decode }}"
        
    - name: Try different parsing methods
      ansible.builtin.shell:
        cmd: |
          echo "=== Method 1: grep + awk ==="
          grep '^postfix:' /root/postgres_service_users.txt | awk '{print $2}'
          echo ""
          echo "=== Method 2: cut ==="
          grep '^postfix:' /root/postgres_service_users.txt | cut -d' ' -f2
          echo ""
          echo "=== Method 3: sed ==="
          grep '^postfix:' /root/postgres_service_users.txt | sed 's/^postfix: *//'
          echo ""
          echo "=== Raw line ==="
          grep '^postfix:' /root/postgres_service_users.txt | cat -A
      register: parsing_tests
      changed_when: false
      
    - name: Display parsing results
      ansible.builtin.debug:
        msg: "{{ parsing_tests.stdout_lines }}"
