---
# ansible/playbooks/cleanup_main_sudoers.yml
---
- name: Clean up main sudoers file default entry
  hosts: all
  become: true
  gather_facts: false
  
  tasks:
    - name: Remove or comment default sudo group entry in main sudoers
      ansible.builtin.replace:
        path: /etc/sudoers
        regexp: '^%sudo\s+ALL=\(ALL:ALL\)\s+ALL'
        replace: '# %sudo   ALL=(ALL:ALL) ALL  # Replaced by /etc/sudoers.d/90-nopasswd-sudo'
        validate: '/usr/sbin/visudo -cf %s'
      tags:
        - sudoers
        - cleanup
    
    - name: Verify sudoers configuration syntax
      ansible.builtin.command:
        cmd: /usr/sbin/visudo -c
      changed_when: false
      tags:
        - verification
